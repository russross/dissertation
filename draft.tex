\documentclass[a4paper,12pt,twoside,openany]{report}
\usepackage{graphicx}
\usepackage{xspace}
\usepackage{url}

% font and encoding setup
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{newcent}

% references
\usepackage{prettyref}
\newrefformat{cha}{Chapter~\ref{#1}}
\newrefformat{sec}{Section~\ref{#1}}
\newrefformat{tab}{Table~\ref{#1}}
\newrefformat{fig}{Figure~\ref{#1}}

% page setup
\usepackage[margin=1.5in]{geometry}
% put section numbers in the margin
\makeatletter
\def\@seccntformat#1{\protect\makebox[0pt][r]{\small\csname the#1\endcsname\quad}}
\makeatother
\usepackage{fancyhdr}
\usepackage{setspace}
\raggedbottom
\renewcommand\footnoterule{\vfill\hrule\vspace{6pt}}

% set up floats
\usepackage[font=small,labelfont=bf]{caption}
\renewcommand{\topfraction}{.8}
\renewcommand{\bottomfraction}{.8}
\renewcommand{\textfraction}{.2}
\renewcommand{\floatpagefraction}{.8}
\newcommand{\figwidth}{.8\textwidth}

\newcommand{\note}[1]{\marginpar{\begin{tiny}#1\end{tiny}}}
%\suppressnotes

% ignore Overfull \vbox messages
\vfuzz 2pt

\clubpenalty=9999
\widowpenalty=9999
\interfootnotelinepenalty=9999

% allow some extra space for paragraph breaking
\setlength{\emergencystretch}{1em}

\newcommand{\thesistitle}{Cluster Storage for Commodity Computation}
\newcommand{\thesistitlebig}{Cluster Storage for\\ Commodity Computation}

% pdf settings
\usepackage[
  %pdftex,
  bookmarks=true,
  linkbordercolor={0 0 1},
  pagebackref=true,
  plainpages=false,
  pdfpagelabels=true,
  hypertexnames=false,
  breaklinks=true]{hyperref}
\hypersetup{
  pdfauthor   = {Russell Glen Ross},
  pdftitle    = {\thesistitle},
  pdfsubject  = {A dissertation submitted to the University of Cambridge
                  for the degree of Doctor of Philosophy},
  pdfkeywords = {File Systems, Distributed Systems, Cluster Storage,
                 Commodity Computation, Virtualization},
  pdfcreator  = {LaTeX with hyperref package},
  pdfproducer = {pdftex}}

\begin{document}

% front matter

\pagestyle{empty}
\include{titlepage}
\cleardoublepage

% set up page headers and footers
\pagestyle{fancyplain}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\plainheadrulewidth}{0pt}
\renewcommand{\plainfootrulewidth}{0pt}
\renewcommand{\chaptermark}[1]{\markboth{#1}{\thechapter.\ #1}}
\renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}}
\headheight 15pt

% no headers for the front matter
\lhead{}
\rhead{}
\cfoot{}

% number the front matter in roman numerals
\pagenumbering{roman}
\lfoot[\sl\thepage]{}
\rfoot[]{\sl\thepage}

\include{preface}
\include{summary}
\include{acknowledgements}

% table of contents

\onehalfspace
\parskip 0pt plus 1pt

\renewcommand\contentsname{Table of Contents}
\tableofcontents

% \clearpage
% \addcontentsline{toc}{chapter}{\listtablename}
% \listoftables
% 
% \clearpage
% \addcontentsline{toc}{chapter}{\listfigurename}
% \listoffigures

% start normal page numbering with page one on the right side
\cleardoublepage
\pagenumbering{arabic}

\parskip 10pt

% page headers with chapter and section names
\makeatletter
  \if@twoside
    \lhead[\fancyplain{}{\sffamily\small\textsl{\leftmark}}]{}
    \rhead[]{\fancyplain{}{\sffamily\small\textsl{\rightmark}}}
  \else
    \lhead[]{\fancyplain{}{\sffamily\small\textsl{\rightmark}}}
  \fi
\makeatother

% main text

\include{01-introduction}
\include{02-background}
\include{03-motivation}
\include{04-design}
\include{05-implementation}
\include{06-evaluation}
\include{07-conclusion}

% bibliography

\clearpage
\singlespace
\renewcommand{\bibname}{References}
\addcontentsline{toc}{chapter}{\bibname}

% hardcode the headers so they are not uppercase
\makeatletter
  \if@twoside
    \lhead[\fancyplain{}{\sffamily\small\textsl{\bibname}}]{}
    \rhead[]{\fancyplain{}{\sffamily\small\textsl{\bibname}}}
  \else
    \lhead[]{\fancyplain{}{\sffamily\small\textsl{\bibname}}}
  \fi
\makeatother

\bibliographystyle{plain}
\bibliography{references}

\end{document}
